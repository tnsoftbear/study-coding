<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      const start = Date.now();
      encr(start);
      encr(start);
      encr(start);
      encr(start);
      encr(start);
      encr(start);
      encr(start);
      encr(start);
      encr(start);
      encr(start);

      function encr(start) {
        var encoder = new TextEncoder("utf-8");
        var clearDataArrayBufferView = encoder.encode(start.toString());

        var aesAlgorithmKeyGen = {
          name: "AES-CBC",
          // AesKeyGenParams
          length: 128,
        };

        var aesAlgorithmEncrypt = {
          name: "AES-CBC",
          // AesCbcParams
          iv: window.crypto.getRandomValues(new Uint8Array(16)),
        };

        // Create a key generator to produce a one-time-use AES key to encrypt some data
        window.crypto.subtle
          .generateKey(aesAlgorithmKeyGen, false, ["encrypt"])
          .then(function (aesKey) {
            return window.crypto.subtle.encrypt(aesAlgorithmEncrypt, aesKey, 
              clearDataArrayBufferView
            );
          })
          .then(function (cipherData) {
            console.log("1:", Date.now() - start);
            console.log("The cipher data buffer is: ", cipherData);
          }, console.error.bind(console, "Unable to encrypt"));
            // console.log.bind(console, "The ciphertext is: "),
      }
    </script>
  </body>
</html>
